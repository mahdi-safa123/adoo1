<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>متجر أدو — تخصيص باقة (مع صور واقعية)</title>
<style>
  body {
    font-family: "Tajawal", Arial, sans-serif;
    background:#fff6fb;
    color:#3c3c3c;
    margin:0;
    padding:24px;
  }
  .container { max-width:980px; margin:auto; }
  h1 { color:#b83b79; text-align:center; margin-bottom:24px; }
  .row { display:flex; gap:18px; flex-wrap:wrap; }
  .panel {
    background:#fff;
    border-radius:12px;
    padding:16px;
    box-shadow:0 8px 20px rgba(0,0,0,.06);
    flex:1;
    min-width:320px;
  }
  .preview-img {
    width:100%;
    height:auto;
    border-radius:12px;
    border:1px solid #f2cfe0;
    display:block;
    transition: transform 0.3s;
  }
  .preview-img:hover { transform: scale(1.05); }
  label { display:block; margin-top:12px; font-weight:700; }
  select,input[type=number] {
    width:100%;
    padding:10px;
    border-radius:8px;
    border:1px solid #f0cfe0;
    margin-top:4px;
  }
  .btn {
    background:#b83b79;
    color:#fff;
    padding:12px 16px;
    border-radius:10px;
    border:0;
    cursor:pointer;
    margin-top:12px;
    width:100%;
    font-weight:700;
    transition: background 0.3s;
  }
  .btn:hover { background:#a33770; }
  .mini { color:#7a7a7a; font-size:13px; margin-top:8px; }
  .summary {
    margin-top:16px;
    font-weight:700;
    color:#a33770;
    font-size:16px;
    background:#ffe4f2;
    padding:10px;
    border-radius:10px;
  }
  @media(max-width:820px){ .row{flex-direction:column} }
</style>
</head>
<body>
<div class="container">
  <h1>صفحة تخصيص الباقة — صور واقعية</h1>
  <div class="row">
    <div class="panel">
      <label>عدد الورود</label>
      <input type="number" id="qty" value="12" min="5" max="100" />
      
      <label>لون الورد</label>
      <select id="roseColor">
        <option value="pink">وردي</option>
        <option value="red">أحمر</option>
        <option value="white">أبيض</option>
        <option value="yellow">أصفر</option>
        <option value="mix">مُختلط</option>
      </select>
      
      <label>لون التغليف</label>
      <select id="wrapColor">
        <option value="wrap-pink">وردي</option>
        <option value="wrap-brown">بني</option>
        <option value="wrap-white">أبيض</option>
        <option value="wrap-clear">شفاف</option>
      </select>
      
      <p class="mini">ملاحظة: النظام يبحث عن ملف بصورة باسم: <code>rose-<span id="previewPattern">pink</span>-wrap-pink-12.jpg</code></p>
      
      <button class="btn" id="updateBtn">تحديث المعاينة</button>
      <button class="btn" id="buyBtn" style="background:#ff6b81;">شراء الباقة</button>
    </div>
    
    <div class="panel">
      <div id="imageBox">
        <img id="previewPhoto" class="preview-img" src="images/placeholder.jpg" alt="معاينة الباقة" />
      </div>
      <div class="summary" id="summaryText">12 وردة — وردي — تغليف وردي — الإجمالي: 24,000 د.ع</div>
    </div>
  </div>
</div>

<script>
  const PRICE = 2000;
  const previewPhoto = document.getElementById('previewPhoto');
  const qtyInput = document.getElementById('qty');
  const colorSel = document.getElementById('roseColor');
  const wrapSel = document.getElementById('wrapColor');
  const summary = document.getElementById('summaryText');
  const previewPattern = document.getElementById('previewPattern');

  function fmt(num){ return num.toLocaleString('ar-IQ'); }

  function fmtWord(num, singular, plural){
    return `${num} ${num === 1 ? singular : plural}`;
  }

  function buildFilename(){
    const color = colorSel.value;
    const wrap = wrapSel.value.replace('wrap-','');
    const qty = parseInt(qtyInput.value||12);
    return `images/rose-${color}-wrap-${wrap}-${qty}.jpg`;
  }

  async function fileExists(url){
    try{
      const resp = await fetch(url, { method:'HEAD' });
      return resp.ok;
    }catch(e){ return false; }
  }

  async function updatePreview(){
    const file = buildFilename();
    previewPattern.textContent = `${colorSel.value}`;
    const qty = parseInt(qtyInput.value||12);
    const total = qty * PRICE;
    
    summary.textContent = `${fmtWord(qty,'وردة','ورد')} — ${colorSel.options[colorSel.selectedIndex].text} — ${wrapSel.options[wrapSel.selectedIndex].text} — الإجمالي: ${fmt(total)} د.ع`;

    const exists = await fileExists(file);
    if(exists){
      previewPhoto.src = file;
      previewPhoto.alt = `باقة ${colorSel.options[colorSel.selectedIndex].text} — ${qty} وردة`;
    } else {
      const fallbackImages = [
        `images/rose-${colorSel.value}-default.jpg`,
        'images/placeholder.jpg'
      ];
      for(const fb of fallbackImages){
        if(await fileExists(fb)){
          previewPhoto.src = fb;
          previewPhoto.alt = 'صورة بديلة';
          break;
        }
      }
    }
  }

  document.getElementById('updateBtn').addEventListener('click', updatePreview);
  qtyInput.addEventListener('change', updatePreview);
  colorSel.addEventListener('change', updatePreview);
  wrapSel.addEventListener('change', updatePreview);

  document.getElementById('buyBtn').addEventListener('click', ()=>{
    const qty = parseInt(qtyInput.value||12);
    const total = qty * PRICE;
    alert(`تم شراء ${qty} وردة — ${colorSel.options[colorSel.selectedIndex].text} — ${wrapSel.options[wrapSel.selectedIndex].text}\nالإجمالي: ${fmt(total)} د.ع`);
  });

  updatePreview();
</script>
</body>
</html>
